# Generated from install-module.R.in
#
Sys.setenv(GITHUB_PAT="@GITHUB_PAT@")
Sys.setenv(RENV_PATHS_ROOT="@MODULES_RENV_ROOT_PATH@")
Sys.setenv(RENV_PATHS_CACHE="@MODULES_RENV_CACHE_PATH@")
Sys.setenv(JASPENGINE_LOCATION="@JASP_ENGINE_PATH@/JASPEngine")
Sys.setenv(JAGS_PREFIX="@jags_HOME@")
Sys.setenv(JAGS_INCLUDEDIR="@jags_INCLUDE_DIRS@")
Sys.setenv(JAGS_LIBDIR="@jags_LIBRARY_DIRS@")

if (@IS_LINUX_LOCAL_BUILD@) {
	# Only set when building using LINUX_LOCAL_BUILD. This is to help jags finds its libraries
	Sys.setenv(LD_LIBRARY_PATH="@jags_LIBRARY_DIRS@")
}

if ((Sys.info()["sysname"] == "Linux") && @IS_LINUX_LOCAL_BUILD@ ) {

	if (@IS_LINUX_LOCAL_BUILD@) {
		# Only set when building using LINUX_LOCAL_BUILD. This helps R to look into the build/R/library
		.libPaths(c('@R_LIBS_LOCAL@', .libPaths()))
	}
	
} 

result <- jaspBase::installJaspModule("@MODULES_SOURCE_PATH@/@MODULE@", 
	libPathsToUse=ifelse("@R_LIBS_LOCAL@" == "NULL", NULL, "@R_LIBS_LOCAL@"), 
	repos="@R_REPOSITORY@", 
	moduleLibrary="@MODULES_BINARY_PATH@/@MODULE@", 
	onlyModPkg=FALSE)
	
print(result)

if (result == "succes") {
	cat(NULL, file="@MODULES_RENV_ROOT_PATH@/@MODULE@-installed-successfully.log")
}

# Converting the absolute symlinks to relative symlinks on macOS
# Todo, I can do this using CMake like I do on Windows
if (Sys.info()["sysname"] == "Darwin") { 
	source('@MODULES_BINARY_PATH@/symlinkTools.R')
	convertAbsoluteSymlinksToRelative('@MODULES_BINARY_PATH@', '@MODULES_RENV_CACHE_PATH@')
}