# We are removing this because having the Libraries/ as a symlink in
# the root of R.framework/ is not acceptable by Apple.
execute_process(WORKING_DIRECTORY @R_FRAMEWORK_INSTALL_PATH@/R.framework
                COMMAND rm -rf Libraries)

message(CHECK_START "Siging 'R.framework'")
execute_process(
  WORKING_DIRECTORY @R_FRAMEWORK_INSTALL_PATH@
  COMMAND codesign --force --deep --verbose=3 --timestamp --strict --sign
          "Developer ID Application: Bruno Boutin (AWJJ3YVK9B)" R.framework)
message(CHECK_FAIL "successful.")

execute_process(WORKING_DIRECTORY @R_FRAMEWORK_INSTALL_PATH@
                COMMAND codesign --verify --verbose R.framework)

message(CHECK_START "Siging 'JASP.app'")
execute_process(
  COMMAND
    codesign --force --deep --verbose=3 --timestamp --strict --entitlements
    "@APPLE_CODESIGN_ENTITLEMENTS@" --sign "@APPLE_CODESIGN_IDENTITY@"
    "@JASP_INSTALL_PREFIX@")
message(CHECK_FAIL "successful.")

execute_process(COMMAND codesign --verify --verbose "@JASP_INSTALL_PREFIX@")
